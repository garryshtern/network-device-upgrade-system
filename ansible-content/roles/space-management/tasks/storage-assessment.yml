---
# Storage Assessment Tasks
# Platform-specific storage space assessment for supported platforms only

- name: Initialize storage assessment variables
  ansible.builtin.set_fact:
    storage_info:
      platform: "{{ platform_type if (platform_type is defined and platform_type in ['opengear', 'metamako_mos']) else ansible_network_os }}"
      total_space_gb: 0
      free_space_gb: 0
      used_space_gb: 0
      images_found: []
      cleanup_candidates: []

- name: Platform-specific storage assessment
  ansible.builtin.include_tasks: "{{ storage_info.platform }}-assessment.yml"

- name: Calculate storage metrics
  ansible.builtin.set_fact:
    storage_info: >-
      {{ storage_info | combine({
        'used_space_gb': storage_info.total_space_gb
          - storage_info.free_space_gb,
        'usage_percentage': ((storage_info.total_space_gb
          - storage_info.free_space_gb) / storage_info.total_space_gb * 100)
          | round(1)
      }) }}
  when: storage_info.total_space_gb > 0
