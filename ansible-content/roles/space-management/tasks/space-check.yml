---
# Storage Space Check Tasks
# Platform-specific storage space validation for supported platforms only

- name: Platform-specific storage assessment
  ansible.builtin.include_tasks: "{{ platform }}-assessment.yml"

- name: Validate storage space availability
  ansible.builtin.assert:
    that:
      - space_check_results.available_space | int >= space_check_results.required_space | int
    fail_msg: >-
      Insufficient storage space: {{ space_check_results.available_space }}GB available,
      {{ space_check_results.required_space }}GB required
    success_msg: >-
      Storage space check passed: {{ space_check_results.available_space }}GB available,
      {{ space_check_results.required_space }}GB required
  when: not ansible_check_mode

- name: Display storage check results
  ansible.builtin.debug:
    msg:
      - "=== Storage Space Check ==="
      - "Device: {{ space_check_results.device }}"
      - "Platform: {{ space_check_results.platform }}"
      - "Required Space: {{ space_check_results.required_space }}GB"
      - "Available Space: {{ space_check_results.available_space }}GB"
      - "Status: {{ 'PASS' if space_check_results.passed else 'FAIL' }}"
      - "=========================="

- name: Record space check completion
  ansible.builtin.include_role:
    name: common
    tasks_from: metrics-export
  vars:
    metric_type: "storage_check"
    metric_data:
      device_id: "{{ inventory_hostname }}"
      platform: "{{ platform }}"
      required_space_gb: "{{ space_check_results.required_space }}"
      available_space_gb: "{{ space_check_results.available_space }}"
      status: "{{ 'success' if space_check_results.passed else 'failed' }}"
      timestamp: "{{ space_check_results.timestamp }}"
