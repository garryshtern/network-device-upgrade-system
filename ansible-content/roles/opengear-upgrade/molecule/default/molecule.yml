---
# Critical Gap #5: Opengear Multi-Architecture Support Testing
# Business Impact: 300K+ USD from console server upgrade failures
# Risk: Architecture detection logic affects upgrade procedures
dependency:
  name: galaxy
  options:
    requirements-file: ${PWD}/ansible-content/collections/requirements.yml

driver:
  name: docker

platforms:
  - name: opengear-x86
    image: python:3.14-slim
    pre_build_image: true
    volumes:
      - ${PWD}:/opt/network-upgrade:rw
    working_dir: /opt/network-upgrade
    command: sleep infinity

  - name: opengear-arm64
    image: python:3.14-slim
    pre_build_image: true
    volumes:
      - ${PWD}:/opt/network-upgrade:rw
    working_dir: /opt/network-upgrade
    command: sleep infinity

provisioner:
  name: ansible
  config_options:
    defaults:
      host_key_checking: false
      stdout_callback: yaml
  inventory:
    host_vars:
      opengear-x86:
        ansible_connection: local
        platform: "opengear"
        architecture: "x86_64"
        model: "IM7208-2-DAC"
        current_firmware: "22.2.1"
        target_firmware: "22.2.5"
        api_available: true

      opengear-arm64:
        ansible_connection: local
        platform: "opengear"
        architecture: "aarch64"
        model: "IM7216-2-LTE"
        current_firmware: "22.2.1"
        target_firmware: "22.2.5"
        api_available: false  # Legacy CLI mode

verifier:
  name: ansible

scenario:
  test_sequence:
    - dependency
    - cleanup
    - destroy
    - syntax
    - create
    - prepare
    - converge
    - idempotence
    - side_effect
    - verify
    - cleanup
    - destroy
