---
# STEP 4: Image Upload and Config Backup
# Server-initiated PUSH only (no device-initiated pulls)
# MUST PASS or workflow STOPS
# Dependencies: STEP 1, STEP 2, STEP 3 (automatically included)

- name: Include STEP 3 as prerequisite (includes STEP 1-2)
  ansible.builtin.include_tasks:
    file: step-3-space-check.yml

- name: Ensure firmware image on device (check bootflash + upload if needed)
  ansible.builtin.include_role:
    name: common
    tasks_from: image-loading

- name: Backup current configuration (after confirming image is staged)
  ansible.builtin.include_role:
    name: common
    tasks_from: config-backup
