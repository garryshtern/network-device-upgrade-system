---
# DEPRECATED: This playbook is deprecated and will be removed in a future version.
#
# Please use main-upgrade-workflow.yml with tags instead:
#   For pre-upgrade validation:
#     ansible-playbook ansible-content/playbooks/main-upgrade-workflow.yml --tags step5 \
#       --extra-vars "target_hosts=mydevice max_concurrent=5"
#   For post-upgrade validation:
#     ansible-playbook ansible-content/playbooks/main-upgrade-workflow.yml --tags step7 \
#       --extra-vars "target_hosts=mydevice max_concurrent=5"
#
# This provides the same functionality with automatic dependency resolution.
#
# Network Validation Playbook
# Comprehensive network state validation and comparison
# Validates BGP, interfaces, routing, multicast, and ARP states
#
# DESIGN: Simplified to use network-validation role
# All orchestration logic is in the role

- name: Network State Validation
  hosts: "{{ target_hosts }}"
  gather_facts: false
  connection: network_cli
  vars:
    validation_timestamp: "{{ lookup('pipe', 'date -u +%Y-%m-%dT%H:%M:%SZ') }}"

  tasks:
    # Gather comprehensive network resources BEFORE validation
    - name: Gather comprehensive network resources for validation
      ansible.builtin.include_role:
        name: common
        tasks_from: network-resources-gathering

    # Run all network validation via role
    - name: Run comprehensive network validation
      ansible.builtin.include_role:
        name: network-validation

    # Display validation results
    - name: Display validation summary
      ansible.builtin.debug:
        msg:
          - "=========================================="
          - "Network Validation Complete"
          - "=========================================="
          - "Device: {{ inventory_hostname }}"
          - "Platform: {{ platform }}"
          - "Timestamp: {{ validation_timestamp }}"
          - "Overall Status: {{ validation_collection_results.overall_status }}"
          - "BGP Status: {{ validation_collection_results.bgp_status }}"
          - "Interface Status: {{ validation_collection_results.interface_status }}"
          - "Routing Status: {{ validation_collection_results.routing_status }}"
          - "ARP Status: {{ validation_collection_results.arp_status }}"
          - "BFD Status: {{ validation_collection_results.bfd_status }}"
          - "=========================================="
      when: validation_collection_results is defined

    # Fail if validation shows unhealthy state
    - name: Verify network validation passed
      ansible.builtin.assert:
        that:
          - validation_collection_results is defined
          - validation_collection_results.overall_status == "PASS"
        fail_msg: "Network validation failed - overall status is {{ validation_collection_results.overall_status if validation_collection_results.overall_status is defined else validation_overall_status }}"
        success_msg: "Network validation passed - all services healthy"
      when: validation_type == 'post_upgrade'
