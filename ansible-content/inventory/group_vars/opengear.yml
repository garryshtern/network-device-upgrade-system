---
# Opengear Specific Configuration
# For console servers and smart PDUs

# Connection settings (auto-detected based on device architecture)
ansible_connection: ssh  # Default to SSH, overridden for modern API devices
ansible_host: "{{ inventory_hostname }}"
ansible_user: "{{ opengear_username }}"
ansible_ssh_pass: "{{ opengear_password }}"
opengear_username: "{{ vault_opengear_username | default('admin') }}"
opengear_password: "{{ vault_opengear_password }}"
opengear_api_token: "{{ vault_opengear_api_token | default(omit) }}"

# Platform specific settings
platform_type: "opengear"
vendor: "opengear"
device_family: "console_server"  # or smart_pdu

# API settings
api_base_url: "https://{{ ansible_host }}/api/v1"
api_timeout: 60
api_retries: 3
validate_certs: false

# Device type detection
auto_detect_device_type: true
supported_models:
  legacy_cli:
    console_servers:
      - "OM2200"    # Legacy console server - CLI only
      - "CM7100"    # Legacy console server - CLI only
  modern_api:
    console_servers:
      - "CM8100"    # Modern console server - Full API + CLI
      - "IM7200"    # Modern infrastructure manager - Full API + CLI
    smart_pdus:
      - "CM8100"    # Can be both console server and PDU

# Architecture detection settings
architecture_detection:
  api_test_timeout: 10
  api_test_endpoints:
    - "/api/v1/system/info"
    - "/api/v2/system/info"
  legacy_cli_commands:
    - "show system info"
    - "show system status"

# Firmware management
firmware_upload_timeout: 3600
firmware_chunk_size: 1048576  # 1MB chunks
verify_firmware_checksum: true
local_firmware_path: "{{ firmware_base_path }}/opengear"

# Console server specific settings
console_server:
  max_serial_ports: 48
  notify_active_sessions: true
  maintenance_mode_message: "Console server firmware upgrade in progress"
  session_timeout_warning: 300  # 5 minutes
  graceful_session_closure: true

# Smart PDU specific settings
smart_pdu:
  max_power_outlets: 24
  power_safety_threshold: 90  # Percentage
  critical_outlet_protection: true
  environmental_monitoring: true
  power_cycle_delay: 5  # seconds

# Serial port management
serial_port_validation:
  test_connectivity: true
  test_timeout: 30
  max_test_ports: 5  # Don't test all ports to avoid disruption

# Power management validation
power_outlet_validation:
  test_non_critical_only: true
  max_test_outlets: 3
  power_cycle_test: false  # Too risky for production

# Network validation
network_connectivity_test:
  enabled: true
  test_host: "8.8.8.8"
  ping_count: 3
  timeout: 10

# Configuration management
backup_config_before_upgrade: true
config_validation_enabled: true
restore_config_on_failure: true

# Environmental monitoring (if available)
environmental_sensors:
  temperature: true
  humidity: true
  validate_thresholds: true

# Upgrade process settings
pre_upgrade_checks: true
post_upgrade_validation: true

# Architecture-specific boot times
boot_times:
  modern_api:
    reboot_wait_time: 120
    service_initialization_wait: 60
  legacy_cli:
    reboot_wait_time: 180  # Legacy devices boot slower
    service_initialization_wait: 120

# Legacy CLI specific settings
legacy_cli:
  upgrade_timeout: 1800  # 30 minutes for legacy upgrades
  progress_check_interval: 30
  max_retries: 60
  cli_timeout: 30
  session_message_delay: 60  # Time to warn users before upgrade
  cleanup_firmware_after_install: true

# Web interface settings
web_interface_timeout: 30
max_upload_retries: 3
session_keepalive: true

# Monitoring integration
export_metrics: true
metric_collection_interval: 60
alert_on_upgrade_failure: true

# Security settings
change_default_passwords: false  # Assume already done
validate_ssl_certificates: false  # Often self-signed
enable_audit_logging: true

# Rollback settings
enable_automatic_rollback: true
rollback_timeout: 600
preserve_user_data: true

# Validation settings specific to device type
console_server_validation:
  - serial_port_count
  - port_connectivity
  - session_capability
  - logging_functionality

smart_pdu_validation:
  - outlet_count
  - power_measurement
  - outlet_control
  - environmental_data
