---
# Global Variables for Network Device Upgrade System
# Applies to all devices across all vendors

# Connection settings
ansible_connection_timeout: 30
ansible_command_timeout: 300
ansible_connect_timeout: 30

# Dynamic connection credentials based on platform variable
# This allows environment variables to work without requiring specific group membership
ansible_user: >-
  {{
    (platform == 'nxos' and vault_cisco_nxos_username is defined) | ternary(vault_cisco_nxos_username, '') or
    (platform == 'ios' and vault_cisco_iosxe_username is defined) | ternary(vault_cisco_iosxe_username, '') or
    (platform == 'fortios' and vault_fortios_username is defined) | ternary(vault_fortios_username, '') or
    (platform == 'opengear' and vault_opengear_username is defined) | ternary(vault_opengear_username, '') or
    (platform == 'metamako_mos' and vault_metamako_username is defined) | ternary(vault_metamako_username, '') or
    'admin'
  }}

ansible_password: >-
  {{
    (platform == 'nxos' and vault_cisco_nxos_password is defined) | ternary(vault_cisco_nxos_password, omit) or
    (platform == 'ios' and vault_cisco_iosxe_password is defined) | ternary(vault_cisco_iosxe_password, omit) or
    (platform == 'fortios' and vault_fortios_password is defined) | ternary(vault_fortios_password, omit) or
    (platform == 'opengear' and vault_opengear_password is defined) | ternary(vault_opengear_password, omit) or
    (platform == 'metamako_mos' and vault_metamako_password is defined) | ternary(vault_metamako_password, omit) or
    omit
  }}

ansible_ssh_private_key_file: >-
  {{
    (platform == 'nxos' and vault_cisco_nxos_ssh_key is defined) | ternary(vault_cisco_nxos_ssh_key, omit) or
    (platform == 'ios' and vault_cisco_iosxe_ssh_key is defined) | ternary(vault_cisco_iosxe_ssh_key, omit) or
    (platform == 'opengear' and vault_opengear_ssh_key is defined) | ternary(vault_opengear_ssh_key, omit) or
    (platform == 'metamako_mos' and vault_metamako_ssh_key is defined) | ternary(vault_metamako_ssh_key, omit) or
    omit
  }}

# Upgrade workflow settings
target_hosts: all  # Default hosts pattern for playbooks
# NOTE: max_concurrent MUST be provided as extra_vars (-e max_concurrent=N)
# The 'serial' keyword is processed before group_vars are loaded by Ansible
max_retry_attempts: 3
connectivity_timeout: 300
reboot_wait_time: 600
validation_timeout: 300
required_space_gb: 4  # Minimum free space required for upgrades (GB)
firmware_size_gb: 2  # Expected firmware image size (GB)
target_firmware: ""  # Must be set at runtime
platform_firmware: {}  # Platform-specific firmware mappings

# Phase control
phase_1_timeout: 3600  # Image loading phase (1 hour)
phase_2_timeout: 1800  # Installation phase (30 minutes)

# Backup and rollback
backup_enabled: true
rollback_on_failure: true
rollback_timeout: 600  # Rollback operation timeout (seconds)
keep_backup_count: 3
maintenance_window: false  # MUST be explicitly set to true for upgrades (safety)
backup_type: "pre_upgrade"  # Type of backup: pre_upgrade, post_upgrade, scheduled
include_startup_config: true  # Include startup config in backups
include_running_config: true  # Include running config in backups
restore_config: true  # Restore config during rollback
restore_firmware: true  # Restore firmware during rollback
emergency_mode: false  # Emergency rollback mode
rollback_reason: "upgrade_failure"  # Default rollback reason

# Validation settings
skip_validation: false
network_state_comparison: true
baseline_capture_enabled: true
convergence_monitoring: true

# Debug settings
show_debug: false  # Set to true to enable verbose debug output

# Storage paths
network_upgrade_base_path: "/var/lib/network-upgrade"
firmware_base_path: "{{ network_upgrade_base_path }}/firmware"
backup_base_path: "{{ network_upgrade_base_path }}/backups"
baseline_base_path: "{{ network_upgrade_base_path }}/baselines"
validation_results_path: "{{ network_upgrade_base_path }}/validation"
compliance_results_path: "{{ network_upgrade_base_path }}/compliance"
log_base_path: "/var/log/network-upgrade"

# Timing settings
pre_upgrade_delay: 30
post_upgrade_delay: 60
interface_stabilization_wait: 120
protocol_convergence_timeout: 300

# Security settings
hash_verification_enabled: true
signature_validation_enabled: false  # Enable if vendor supports it
cleanup_images_after_upgrade: false

# Monitoring and metrics
export_metrics: true
metrics_batch_size: 100
metrics_export_interval: 30

# Notification settings
send_notifications: true
notification_on_failure: true
notification_on_success: false

# Environmental validation
check_environmental_sensors: true
temperature_threshold_celsius: 45
power_threshold_percent: 85

# Network validation settings
ping_test_enabled: true
ping_test_host: "8.8.8.8"
ping_test_count: 3
bgp_enabled: true  # Enable BGP validation checks
bfd_enabled: true  # Enable BFD validation checks
multicast_enabled: true  # Enable multicast validation checks
validation_type: "post_upgrade"  # Default validation type: pre_upgrade or post_upgrade

# Logging
log_level: "info"  # debug, info, warning, error
structured_logging: true
log_retention_days: 30
debug_metrics: false  # Enable verbose metrics debugging output

# Compliance and reporting
generate_report: true  # Generate compliance/validation reports
send_metrics: true  # Send metrics to monitoring systems
log_metrics_locally: false  # Log metrics to local files
compliance_standards: ['security_baseline', 'network_hardening']  # Default compliance standards
current_firmware_version: "unknown"  # Current firmware version (detected at runtime)
site_name: "unknown"  # Site/location name
vendor: "unknown"  # Device vendor
validation_score: 0  # Validation score (calculated at runtime)

# Common upgrade state base (extended by vendor roles)
common_upgrade_state:
  device: "{{ inventory_hostname }}"
  current_version: ""
  target_version: "{{ target_firmware }}"
  upgrade_start_time: ""
  upgrade_end_time: ""
  upgrade_status: "not_started"

# Platform-to-role mapping for dynamic role selection
# Maps platform identifier to upgrade role name
platform_role_map:
  nxos: "cisco-nxos-upgrade"
  ios: "cisco-iosxe-upgrade"
  fortios: "fortios-upgrade"
  metamako_mos: "metamako-mos-upgrade"
  metamako: "metamako-mos-upgrade"
  opengear: "opengear-upgrade"
