---
# Cisco NX-OS Specific Configuration
# For Nexus switches and NX-OS devices

# Connection settings - SSH key authentication preferred over passwords
ansible_network_os: cisco.nxos.nxos
ansible_connection: ansible.netcommon.network_cli

# Platform identifier (use this in playbooks, NOT ansible_network_os)
platform: nxos

ansible_user: "{{ vault_cisco_nxos_username | default('admin') }}"
# SSH key authentication (preferred)
ansible_ssh_private_key_file: "{{ vault_cisco_nxos_ssh_key | default(omit) }}"
# Password authentication (fallback)
ansible_password: "{{ vault_cisco_nxos_password | default(omit) }}"
ansible_ssh_common_args: >
  -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null
  -o PubkeyAuthentication=yes -o PreferredAuthentications=publickey,password

# Platform specific settings
vendor: "cisco"
device_family: "nexus"

# ISSU settings
enable_issu: true
issu_timeout: 3600
check_issu_compatibility: true

# EPLD upgrade settings
enable_epld_upgrade: false  # Set to true when EPLD upgrade is needed
epld_upgrade_timeout: 7200
allow_disruptive_epld: false

# NX-OS specific timeouts
nxos_install_timeout: 3600
nxos_reboot_timeout: 900
nxos_copy_timeout: 1800

# Image management - Server-initiated PUSH only
# All images are pushed from the upgrade server to devices
# No device-initiated connections to image servers

# Storage management
min_free_space_mb: 2000
cleanup_old_images: true
keep_image_count: 2

# Firmware filename patterns (MANDATORY - per docs/firmware-naming-standards.md)
device_model_patterns:
  - regex: "N9K-C92.*"
    platform: "nexus_9000"
    model_prefix: "N9K-C92"
  - regex: "N9K-C93.*"
    platform: "nexus_9000"
    model_prefix: "N9K-C93"
  - regex: "N3K-C354.*"
    platform: "nexus_3548"
    model_prefix: "N3K-C354"

firmware_filename_patterns:
  nexus_9000:
    default: "nxos64-cs.{{ target_firmware_version }}.M.bin"
  nexus_3548:
    default: "nxos64-msll.{{ target_firmware_version }}.M.bin"
  default: "nxos64-cs.{{ target_firmware_version }}.M.bin"

epld_firmware_patterns:
  nexus_9000:
    default: "n9000-epld.{{ target_epld_version if target_epld_version != '' else target_firmware_version }}.img"
  default: "n9000-epld.{{ target_epld_version if target_epld_version != '' else target_firmware_version }}.img"

# Validation specific to NX-OS
validate_vdc_mode: true
validate_feature_set: true
check_license_usage: true

# BGP validation
validate_bgp: true
bgp_convergence_timeout: 300
expected_bgp_neighbors: []  # Define per host

# OSPF validation
validate_ospf: true
ospf_convergence_timeout: 180

# Interface validation
validate_port_channels: true
validate_vpc: true
check_transceiver_status: true

# Multicast validation
validate_pim: true
validate_igmp: true
check_rp_reachability: true

# VDC settings (if applicable)
vdc_mode: false
target_vdc: "{{ ansible_host }}-vdc"

# Boot variables (MANDATORY: Use compliant naming per docs/firmware-naming-standards.md)
# Default to nxos64-cs pattern for Nexus 9000 (most common)
primary_boot_image: "bootflash:///nxos64-cs.{{ target_firmware_version }}.M.bin"
secondary_boot_image: "bootflash:///nxos64-cs.backup.M.bin"

# Feature validation
required_features:
  - "bgp"
  - "ospf"
  - "pim"
  - "igmp"
  - "vpc"
  - "lacp"

# Error thresholds
max_interface_errors: 100
max_crc_errors: 50
max_late_collisions: 10
