---
# Error handling test playbook
# Tests error conditions and recovery scenarios

- name: Error Handling Tests
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    error_scenarios:
      - name: "Missing Required Variables"
        test_vars:
          platform_type: "cisco_nxos"
          # Missing firmware_version intentionally
        should_fail: true
        error_type: "missing_variables"
        
      - name: "Invalid Platform Type"
        test_vars:
          platform_type: "invalid_platform"
          firmware_version: "1.0.0"
          target_version: "2.0.0"
        should_fail: true
        error_type: "invalid_platform"
        
      - name: "Version Downgrade Attempt"
        test_vars:
          platform_type: "cisco_nxos"
          firmware_version: "10.1.2"
          target_version: "9.3.10"  # Downgrade
        should_fail: true
        error_type: "version_downgrade"
        
      - name: "Same Version Upgrade"
        test_vars:
          platform_type: "cisco_iosxe"
          firmware_version: "17.06.04"
          target_version: "17.06.04"  # Same version
        should_fail: true
        error_type: "same_version"
        
      - name: "Valid Configuration"
        test_vars:
          platform_type: "fortios"
          firmware_version: "7.0.8"
          target_version: "7.2.4"
        should_fail: false
        error_type: "none"

  tasks:
    - name: Test error handling scenarios
      include_tasks: test_error_scenario.yml
      loop: "{{ error_scenarios }}"
      loop_control:
        loop_var: error_test
        label: "{{ error_test.name }}"
        
    - name: Error handling tests completed
      debug:
        msg: "All error handling tests completed successfully"