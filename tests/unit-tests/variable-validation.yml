---
# Variable validation test playbook
# Tests all required variables and their constraints

- name: Variable Validation Tests
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    test_scenarios:
      - name: "Valid NX-OS Variables"
        vars:
          platform_type: "cisco_nxos"
          firmware_version: "9.3.10"
          target_version: "10.1.2"
          upgrade_phase: "loading"
          skip_validation: false
        should_pass: true

      - name: "Valid IOS-XE Variables"
        vars:
          platform_type: "cisco_iosxe"
          firmware_version: "16.12.07"
          target_version: "17.06.04"
          upgrade_phase: "installation"
          skip_validation: false
        should_pass: true

      - name: "Invalid Platform Type"
        vars:
          platform_type: "invalid_platform"
          firmware_version: "1.0.0"
          target_version: "2.0.0"
          upgrade_phase: "loading"
        should_pass: false

      - name: "Missing Required Variables"
        vars:
          platform_type: "cisco_nxos"
          # Missing firmware_version and target_version
        should_pass: false

      - name: "Invalid Upgrade Phase"
        vars:
          platform_type: "fortios"
          firmware_version: "7.0.8"
          target_version: "7.2.4"
          upgrade_phase: "invalid_phase"
        should_pass: false

  tasks:
    - name: Run validation test scenarios
      include_tasks: validate_scenario.yml
      loop: "{{ test_scenarios }}"
      loop_control:
        loop_var: scenario
        label: "{{ scenario.name }}"

    - name: Summary of validation tests
      debug:
        msg: "All variable validation tests completed successfully"
